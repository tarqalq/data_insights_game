<%- include('partials/header') %>

    <style>
        .tutorial-card {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
        }

        .tutorial-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg), var(--shadow-glow);
        }

        .tutorial-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--accent-green);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .tutorial-icon {
            font-size: 1.8rem;
        }

        .tutorial-content {
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.7;
        }

        .tutorial-content ul,
        .tutorial-content ol {
            margin: 10px 0;
            padding-right: 20px;
        }

        .tutorial-content li {
            margin: 8px 0;
        }

        .role-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .role-citizen {
            background: var(--success-bg);
            border: 1px solid var(--success-border);
            color: var(--accent-green);
        }

        .role-spy {
            background: var(--error-bg);
            border: 1px solid var(--error-border);
            color: #ef4444;
        }
    </style>

    <div class="container animate-pop">
        <div class="status-indicator-wrapper">
            <div class="pulse-circle"></div>
            <div class="pulse-circle-inner"></div>
            <i class="status-icon">โจ</i>
        </div>

        <h2 class="main-title-lobby">ุฃูุช ุฌุงูุฒ! ๐ฎ</h2>
        <p class="lobby-welcome">ุฃููุงู ุจูุ <span style="color: var(--accent-green);">
                <%= typeof playerName !=='undefined' ? playerName : 'ูุง ุตุฏููู' %>
            </span></p>
        <p class="lobby-subtext">ุงูุชุธุฑ ุงูููุธู ููุจุฏุฃ ุงููุนุจุฉ</p>

        <div class="divider"></div>

        <div class="players-counter-section">
            <div class="counter-glow-wrapper">
                <span id="currentCount" class="counter-number">0</span>
            </div>
            <p class="counter-label">ูุดุงุฑู ูู ุงูุงูุชุธุงุฑ</p>
        </div>

        <!-- ุงูุชูุชุฑูุงู ุงููุงูู -->
        <h3 style="text-align: center; font-size: 1.8rem; margin: 30px 0 20px; color: var(--accent-green);">๐ ุชุฐููุฑ
            ุจููุงุนุฏ ุงููุนุจุฉ</h3>

        <div class="tutorial-card">
            <div class="tutorial-title">
                <span class="tutorial-icon">๐ฏ</span>
                <span>ุงููุฏู ูู ุงููุนุจุฉ</span>
            </div>
            <div class="tutorial-content">
                <p>ุงููุนุจุฉ ุชุนุชูุฏ ุนูู ูุธุงู ุงูุฃุณุฆูุฉ ูุงูุฃุฌูุจุฉ ูุน ูุฌูุฏ "ุฌูุงุณูุณ" ูุญุงูููู ุงูุงูุฏูุงุฌ ูุน ุงูููุงุทููู.</p>
                <ul>
                    <li><strong>ุงูููุงุทููู:</strong> ูุญุงูููู ุงูุชุดุงู ุงูุฌูุงุณูุณ ูู ุฎูุงู ุฅุฌุงุจุงุชูู</li>
                    <li><strong>ุงูุฌูุงุณูุณ:</strong> ูุญุงูููู ุงูุงูุฏูุงุฌ ูุนุฏู ุงููุดู ุนู ูููุชูู</li>
                </ul>
            </div>
        </div>

        <div class="tutorial-card">
            <div class="tutorial-title">
                <span class="tutorial-icon">๐ฅ</span>
                <span>ุงูุฃุฏูุงุฑ</span>
            </div>
            <div class="tutorial-content">
                <p>ูู ูู ุฌููุฉุ ุณูุชู ุชูุฒูุน ุงูุฃุฏูุงุฑ ุจุดูู ุนุดูุงุฆู:</p>
                <ul>
                    <li><span class="role-badge role-citizen">ููุงุทู</span> - ูุญุตู ุนูู ุงูุณุคุงู ุงูุนุงู</li>
                    <li><span class="role-badge role-spy">ุฌุงุณูุณ</span> - ูุญุตู ุนูู ุณุคุงู ูุฎุชูู</li>
                </ul>
            </div>
        </div>

        <div class="tutorial-card">
            <div class="tutorial-title">
                <span class="tutorial-icon">๐ฎ</span>
                <span>ุฎุทูุงุช ุงููุนุจ</span>
            </div>
            <div class="tutorial-content">
                <ol>
                    <li><strong>ุงูุชุณุฌูู:</strong> ุฃุฏุฎู ุงุณูู ููุงูุถูุงู</li>
                    <li><strong>ุงูุงูุชุธุงุฑ:</strong> ุงูุชุธุฑ ุญุชู ูุจุฏุฃ ุงูููุธู ุงููุนุจุฉ</li>
                    <li><strong>ุงูุฅุฌุงุจุฉ:</strong> ุฃุฌุจ ุนูู ุงูุณุคุงู ุจุตุฏู</li>
                    <li><strong>ุงูุชุตููุช:</strong> ุตููุช ุนูู ูู ุชุธู ุฃููู ุงูุฌูุงุณูุณ</li>
                    <li><strong>ุงููุชุงุฆุฌ:</strong> ุดุงูุฏ ูู ูุงู ุงูุฌุงุณูุณ!</li>
                </ol>
            </div>
        </div>

        <div class="tutorial-card">
            <div class="tutorial-title">
                <span class="tutorial-icon">๐</span>
                <span>ูุธุงู ุงูููุงุท</span>
            </div>
            <div class="tutorial-content">
                <p><strong>ููููุงุทููู:</strong></p>
                <ul>
                    <li>+1 ููุทุฉ ููู ุฌุงุณูุณ ุชุตูุช ุนููู ุจุดูู ุตุญูุญ</li>
                </ul>
                <p><strong>ููุฌูุงุณูุณ:</strong></p>
                <ul>
                    <li>ูููุง ุงูุฏูุฌุช ุฃูุซุฑ ููู ูุชู ุงูุชุดุงููุ ูุณุจุช ููุงุท ุฃูุซุฑ!</li>
                </ul>
            </div>
        </div>

        <div class="tutorial-card">
            <div class="tutorial-title">
                <span class="tutorial-icon">๐ก</span>
                <span>ูุตุงุฆุญ ููููุฒ</span>
            </div>
            <div class="tutorial-content">
                <ul>
                    <li><strong>ูู ุตุงุฏูุงู:</strong> ุฅุฐุง ููุช ููุงุทูุงูุ ุฃุฌุจ ุจุตุฏู</li>
                    <li><strong>ูู ุฐููุงู:</strong> ุฅุฐุง ููุช ุฌุงุณูุณุงูุ ุญุงูู ุงูุงูุฏูุงุฌ</li>
                    <li><strong>ุฑุงูุจ ุงูุฅุฌุงุจุงุช:</strong> ุงุจุญุซ ุนู ุงูุฅุฌุงุจุงุช ุงูุบุฑูุจุฉ</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io(); // ุณูุชู ุฅุฑุณุงู ุงูููููุฒ ุชููุงุฆูุงู ูููุตุงุฏูุฉ
        const currentCountDisp = document.getElementById('currentCount');

        // ุงูุชุนุงูู ูุน ุฑูุถ ุงูุงุชุตุงู ุฅุฐุง ูุงูุช ุงูุฌูุณุฉ ุบูุฑ ุตุงูุญุฉ
        socket.on('connect_error', (err) => {
            // ุฅุฐุง ุฑูุถ ุงูุณูุฑูุฑ ุงูุงุชุตุงูุ ูุนูุฏ ุชูุฌูู ุงููุณุชุฎุฏู ูุชุณุฌูู ุงูุฏุฎูู
            if (!window.location.search.includes('error=auth')) {
                window.location.replace('/?error=auth');
            }
        });

        socket.on('update_player_count', (count) => {
            if (currentCountDisp) {
                currentCountDisp.innerText = count;
            }
        });

        socket.on('receive_question', (data) => {
            // ุชุฎุฒูู ูุคูุช ููุฏุนูุ ููู ุงูุณูุฑูุฑ ูู ุงููุตุฏุฑ ุงูุฃุณุงุณู ุงูุขู
            sessionStorage.setItem('currentQuestion', data.question);
            sessionStorage.setItem('playerRole', data.role);

            // ุงูุชุญูู ูู ุงูููุงู ุงูุญุงูู ูุชุฌูุจ ุฅุนุงุฏุฉ ุงูุชูุฌูู ุบูุฑ ุงูุถุฑูุฑูุฉ (ุฑุบู ุฃููุง ูู ุงูููุจู)
            if (window.location.pathname !== '/game') {
                window.location.replace('/game');
            }
        });

        socket.on('game_started_display', () => {
            // ุงุญุชูุงุทู ูู ุญุงู ูู ุชุตู receive_question
        });

        socket.on('force_logout', () => {
            window.location.replace('/');
        });
    </script>

    <%- include('partials/footer') %>